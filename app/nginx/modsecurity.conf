# Habilitar ModSecurity
SecRuleEngine On

# Request body processing
SecRequestBodyAccess On
SecRequestBodyLimit 13107200
SecRequestBodyNoFilesLimit 131072

# Response body processing
SecResponseBodyAccess Off

# Audit logging
SecAuditEngine RelevantOnly
SecAuditLog /var/log/modsec_audit.log
SecAuditLogParts ABIJDEFHZ

# Argumentos
SecArgumentSeparator &
SecCookieFormat 0

# Diretórios temporários
SecTmpDir /tmp/
SecDataDir /tmp/

# ===== REMOVER DEBUG LOG =====
# SecDebugLog /var/log/modsec_debug.log
# SecDebugLogLevel 0

# Incluir OWASP CRS
Include /etc/modsecurity.d/owasp-crs/crs-setup.conf
Include /etc/modsecurity.d/owasp-crs/rules/*.conf

# Regras customizadas
SecRule ARGS|REQUEST_BODY "@rx (?i:(\bunion\b.+\bselect\b|\binsert\b.+\binto\b|\bdelete\b.+\bfrom\b|\bdrop\b.+\btable\b))" \
    "id:1001,phase:2,block,log,msg:'SQL Injection attempt',severity:CRITICAL,tag:'attack-sqli'"

SecRule ARGS|REQUEST_BODY "@rx (?i:(<script|javascript:|onerror\s*=|onload\s*=|<iframe))" \
    "id:1002,phase:2,block,log,msg:'XSS attempt',severity:CRITICAL,tag:'attack-xss'"

SecRule ARGS|REQUEST_URI "@rx (?i:(\.\.\/|\.\.\\))" \
    "id:1003,phase:1,block,log,msg:'Path traversal attempt',severity:WARNING,tag:'attack-traversal'"