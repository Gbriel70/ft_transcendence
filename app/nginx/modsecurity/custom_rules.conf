# ===== REGRAS CUSTOMIZADAS =====

# Brute Force Protection - Login
SecRule REQUEST_URI "@contains /api/auth/login" \
    "id:10001,\
    phase:2,\
    pass,\
    setvar:ip.login_attempts=+1,\
    expirevar:ip.login_attempts=300,\
    nolog"

SecRule IP:LOGIN_ATTEMPTS "@gt 5" \
    "id:10002,\
    phase:2,\
    deny,\
    status:429,\
    msg:'Too many login attempts - Rate limit exceeded',\
    logdata:'IP: %{REMOTE_ADDR} - Attempts: %{ip.login_attempts}'"

# Brute Force Protection - Register
SecRule REQUEST_URI "@contains /api/auth/register" \
    "id:10003,\
    phase:2,\
    pass,\
    setvar:ip.register_attempts=+1,\
    expirevar:ip.register_attempts=600,\
    nolog"

SecRule IP:REGISTER_ATTEMPTS "@gt 3" \
    "id:10004,\
    phase:2,\
    deny,\
    status:429,\
    msg:'Too many registration attempts'"

# Bloquear user agents específicos
SecRule REQUEST_HEADERS:User-Agent "@rx (curl|wget|sqlmap|nikto|masscan)" \
    "id:10005,\
    phase:1,\
    deny,\
    status:403,\
    msg:'Blocked suspicious user agent',\
    severity:WARNING"

# Proteção adicional contra SQL Injection
SecRule ARGS "@rx (?i)(union.*select.*from|insert.*into.*values|delete.*from.*where)" \
    "id:10006,\
    phase:2,\
    deny,\
    status:403,\
    msg:'SQL Injection attempt blocked',\
    severity:CRITICAL,\
    tag:'CUSTOM/SQL_INJECTION'"